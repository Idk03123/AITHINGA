<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Maker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .premium-badge {
            display: inline-block;
            background: gold;
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .config-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e0e0e0;
        }

        .premium-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .premium-details {
            flex: 1;
        }

        .premium-details h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .premium-details p {
            color: #555;
            font-size: 0.95em;
        }

        .btn-premium {
            padding: 12px 30px;
            background: #333;
            color: gold;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .premium-active {
            background: #2ecc71;
            color: white;
        }

        .generations-count {
            font-size: 1.2em;
            color: #667eea;
            font-weight: bold;
            text-align: center;
        }

        .main-content {
            display: flex;
            height: calc(100vh - 450px);
            min-height: 600px;
        }

        .input-panel {
            flex: 1;
            padding: 30px;
            border-right: 2px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        .output-panel {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
        }

        textarea {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            resize: none;
            margin-bottom: 15px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-primary:hover, .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:disabled, .btn-secondary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .canvas-container {
            flex: 1;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .status {
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .modal-content p {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .premium-code-input {
            width: 100%;
            padding: 12px;
            margin: 20px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .price {
            font-size: 3em;
            color: #667eea;
            font-weight: bold;
            margin: 20px 0;
        }

        .price span {
            font-size: 0.4em;
            color: #999;
        }

        .btn-close {
            background: #e0e0e0;
            color: #333;
            margin-left: 10px;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
                height: auto;
            }

            .input-panel, .output-panel {
                border-right: none;
                border-bottom: 2px solid #e0e0e0;
                min-height: 400px;
            }

            .premium-info {
                flex-direction: column;
                text-align: center;
            }

            .btn-premium {
                margin-top: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal active" id="loginModal">
        <div class="modal-content">
            <h2>üîê Welcome to AI Code Maker</h2>
            <p>Login or create an account to get started</p>
            <div style="text-align: left; margin: 20px 0;">
                <input type="text" id="loginUsername" placeholder="Username" style="width: 100%; padding: 12px; margin-bottom: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                <input type="password" id="loginPassword" placeholder="Password" style="width: 100%; padding: 12px; margin-bottom: 20px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
            </div>
            <div id="loginStatus" style="margin-bottom: 15px; color: #721c24;"></div>
            <button class="btn btn-primary" id="loginBtn" style="width: 100%; margin-bottom: 10px;">Login</button>
            <button class="btn btn-secondary" id="signupBtn" style="width: 100%;">Create Account</button>
        </div>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <div class="header">
            <h1>üöÄ AI Code Maker <span class="premium-badge" id="premiumBadge" style="display: none;">PREMIUM</span></h1>
            <p>Generate code with Claude AI instantly</p>
            <button class="logout-btn" id="logoutBtn">Logout</button>
        </div>

        <div class="config-section">
            <div class="premium-info">
                <div class="premium-details">
                    <h3 id="premiumTitle">‚≠ê Upgrade to Premium</h3>
                    <p id="premiumDesc">Get unlimited code generations for just $5.99/month!</p>
                </div>
                <button class="btn-premium" id="premiumBtn">Upgrade Now</button>
            </div>

            <div class="generations-count">
                Generations Left: <span id="genCount">3</span>
            </div>
        </div>

        <div class="main-content">
            <div class="input-panel">
                <h2>üìù Code Request</h2>
                <textarea id="prompt" placeholder="Describe the code you want to create...

Example: Create a simple calculator with buttons for add, subtract, multiply and divide"></textarea>
                <button class="btn btn-primary" id="generateBtn">Generate Code</button>
                <button class="btn btn-secondary" id="requestChangesBtn" style="display: none;">Request Changes</button>
            </div>

            <div class="output-panel">
                <h2>üé® Live Preview</h2>
                <div id="status"></div>
                <div class="canvas-container">
                    <iframe id="preview"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Premium Modal -->
    <div class="modal" id="premiumModal">
        <div class="modal-content">
            <h2>‚≠ê Upgrade to Premium</h2>
            <p>Unlock unlimited code generations and get the most out of AI Code Maker!</p>
            <div class="price">$5.99<span>/month</span></div>
            <p><strong>Benefits:</strong><br>
            ‚úì Unlimited Generations<br>
            ‚úì Priority Support<br>
            ‚úì Advanced Features</p>
            <button class="btn btn-primary" id="activatePremiumBtn">Go to Payment</button>
            <button class="btn btn-close" id="closeModalBtn">Maybe Later</button>
            
            <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e0e0e0;">
                <p style="margin-bottom: 15px;"><strong>Already paid?</strong> Enter your payment code:</p>
                <input type="text" id="premiumCode" class="premium-code-input" placeholder="Enter premium code">
                <button class="btn btn-secondary" id="verifyCodeBtn" style="width: 100%;">Activate Premium</button>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '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';

        let generations = 3;
        let isPremium = false;
        let conversationHistory = [];
        let currentCode = '';
        let currentUser = null;

        const promptInput = document.getElementById('prompt');
        const generateBtn = document.getElementById('generateBtn');
        const requestChangesBtn = document.getElementById('requestChangesBtn');
        const preview = document.getElementById('preview');
        const status = document.getElementById('status');
        const genCount = document.getElementById('genCount');
        const premiumBtn = document.getElementById('premiumBtn');
        const premiumBadge = document.getElementById('premiumBadge');
        const premiumModal = document.getElementById('premiumModal');
        const activatePremiumBtn = document.getElementById('activatePremiumBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const premiumTitle = document.getElementById('premiumTitle');
        const premiumDesc = document.getElementById('premiumDesc');

        // Login elements
        const loginModal = document.getElementById('loginModal');
        const mainContainer = document.getElementById('mainContainer');
        const loginUsername = document.getElementById('loginUsername');
        const loginPassword = document.getElementById('loginPassword');
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginStatus = document.getElementById('loginStatus');

        // Premium code verification
        const premiumCodeInput = document.getElementById('premiumCode');
        const verifyCodeBtn = document.getElementById('verifyCodeBtn');
        const validPremiumCodes = ['PREMIUM2024', 'AICODE-PRO', 'UNLOCK-PREMIUM'];

        // Get or create device ID
        function getDeviceId() {
            let deviceId = localStorage.getItem('deviceId');
            if (!deviceId) {
                deviceId = 'device_' + Math.random().toString(36).substr(2, 9) + Date.now();
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }

        // Get users database from localStorage
        function getUsersDB() {
            const db = localStorage.getItem('usersDB');
            return db ? JSON.parse(db) : {};
        }

        // Save users database to localStorage
        function saveUsersDB(users) {
            localStorage.setItem('usersDB', JSON.stringify(users));
        }

        // Get device accounts from localStorage
        function getDeviceAccounts() {
            const accounts = localStorage.getItem('deviceAccounts');
            return accounts ? JSON.parse(accounts) : [];
        }

        // Save device accounts to localStorage
        function saveDeviceAccounts(accounts) {
            localStorage.setItem('deviceAccounts', JSON.stringify(accounts));
        }

        // Check if user is logged in on page load
        window.addEventListener('load', () => {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                loadUserData();
                showMainApp();
            }
        });

        loginBtn.addEventListener('click', () => {
            handleLogin();
        });

        signupBtn.addEventListener('click', () => {
            handleSignup();
        });

        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('currentUser');
            currentUser = null;
            generations = 3;
            isPremium = false;
            loginModal.classList.add('active');
            mainContainer.style.display = 'none';
            loginUsername.value = '';
            loginPassword.value = '';
            loginStatus.textContent = '';
        });

        function handleLogin() {
            const username = loginUsername.value.trim();
            const password = loginPassword.value.trim();

            if (!username || !password) {
                loginStatus.textContent = 'Please enter username and password';
                return;
            }

            const users = getUsersDB();

            if (users[username] && users[username].password === password) {
                currentUser = username;
                localStorage.setItem('currentUser', username);
                loadUserData();
                showMainApp();
                loginStatus.textContent = '';
            } else {
                loginStatus.textContent = 'Invalid username or password';
            }
        }

        function handleSignup() {
            const username = loginUsername.value.trim();
            const password = loginPassword.value.trim();

            if (!username || !password) {
                loginStatus.textContent = 'Please enter username and password';
                return;
            }

            if (username.length < 3) {
                loginStatus.textContent = 'Username must be at least 3 characters';
                return;
            }

            if (password.length < 4) {
                loginStatus.textContent = 'Password must be at least 4 characters';
                return;
            }

            const deviceId = getDeviceId();
            const deviceAccounts = getDeviceAccounts();
            
            if (deviceAccounts.includes(deviceId)) {
                loginStatus.textContent = 'This device has already created an account. Please login with your existing account.';
                return;
            }

            const users = getUsersDB();

            if (users[username]) {
                loginStatus.textContent = 'Username already exists';
                return;
            }

            users[username] = {
                password: password,
                generations: 3,
                isPremium: false,
                createdAt: new Date().toISOString(),
                deviceId: deviceId
            };

            saveUsersDB(users);

            // Mark this device as having created an account
            deviceAccounts.push(deviceId);
            saveDeviceAccounts(deviceAccounts);

            currentUser = username;
            localStorage.setItem('currentUser', username);
            generations = 3;
            isPremium = false;
            showMainApp();
            loginStatus.textContent = '';
        }

        function loadUserData() {
            const users = getUsersDB();
            
            if (users[currentUser]) {
                generations = users[currentUser].generations;
                isPremium = users[currentUser].isPremium || false;
                
                genCount.textContent = isPremium ? '‚àû' : generations;
                
                if (isPremium) {
                    premiumBadge.style.display = 'inline-block';
                    premiumBtn.textContent = 'Premium Active ‚úì';
                    premiumBtn.classList.add('premium-active');
                    premiumTitle.textContent = 'üéâ Premium Active!';
                    premiumDesc.textContent = 'You have unlimited generations. Enjoy!';
                }
            }
        }

        function saveUserData() {
            const users = getUsersDB();
            
            if (users[currentUser]) {
                users[currentUser].generations = generations;
                users[currentUser].isPremium = isPremium;
                saveUsersDB(users);
            }
        }

        function showMainApp() {
            loginModal.classList.remove('active');
            mainContainer.style.display = 'block';
        }

        premiumBtn.addEventListener('click', () => {
            if (!isPremium) {
                premiumModal.classList.add('active');
            }
        });

        closeModalBtn.addEventListener('click', () => {
            premiumModal.classList.remove('active');
        });

        verifyCodeBtn.addEventListener('click', () => {
            const code = premiumCodeInput.value.trim().toUpperCase();
            
            if (!code) {
                alert('Please enter a premium code');
                return;
            }

            if (validPremiumCodes.includes(code)) {
                activatePremium();
                premiumCodeInput.value = '';
            } else {
                alert('Invalid premium code. Please check your code and try again.');
            }
        });

        activatePremiumBtn.addEventListener('click', () => {
            const stripePaymentLink = 'https://buy.stripe.com/test_6oU9AV41L9i13WDeQDenS00';
            window.open(stripePaymentLink, '_blank');
            showStatus('Please complete payment to activate premium...', 'info');
            premiumModal.classList.remove('active');
        });

        function activatePremium() {
            isPremium = true;
            premiumModal.classList.remove('active');
            premiumBadge.style.display = 'inline-block';
            genCount.textContent = '‚àû';
            premiumBtn.textContent = 'Premium Active ‚úì';
            premiumBtn.classList.add('premium-active');
            premiumTitle.textContent = 'üéâ Premium Active!';
            premiumDesc.textContent = 'You have unlimited generations. Enjoy!';
            showStatus('Premium activated! You now have unlimited generations!', 'success');
            
            saveUserData();
        }

        generateBtn.addEventListener('click', async () => {
            await generateCode(false);
        });

        requestChangesBtn.addEventListener('click', async () => {
            await generateCode(true);
        });

        async function generateCode(isChange) {
            const prompt = promptInput.value.trim();

            if (!API_KEY || API_KEY === '') {
                showStatus('Please add your API key in the code!', 'error');
                return;
            }

            if (!prompt) {
                showStatus('Please enter a code request', 'error');
                return;
            }

            if (!isPremium && generations <= 0) {
                showStatus('No generations left! Upgrade to Premium for unlimited generations', 'error');
                premiumModal.classList.add('active');
                return;
            }

            generateBtn.disabled = true;
            requestChangesBtn.disabled = true;
            showStatus(isChange ? 'Applying changes...' : 'Generating code...', 'info');

            try {
                let messages = [];
                
                if (isChange && conversationHistory.length > 0) {
                    messages = [...conversationHistory, {
                        role: 'user',
                        content: `Make the following changes to the code: ${prompt}\n\nReturn ONLY the complete updated HTML code, no explanations.`
                    }];
                } else {
                    conversationHistory = [];
                    messages = [{
                        role: 'user',
                        content: `Create a complete, working HTML file with embedded CSS and JavaScript for the following request. Return ONLY the HTML code, no explanations or markdown formatting:\n\n${prompt}`
                    }];
                }

                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': API_KEY,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 4000,
                        messages: messages
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'API request failed');
                }

                const data = await response.json();
                const code = data.content[0].text;

                let cleanCode = code.replace(/```html\n?/g, '').replace(/```\n?/g, '').trim();
                currentCode = cleanCode;

                conversationHistory.push({
                    role: 'user',
                    content: prompt
                });
                conversationHistory.push({
                    role: 'assistant',
                    content: code
                });

                preview.srcdoc = cleanCode;

                if (!isPremium) {
                    generations--;
                    genCount.textContent = generations;
                    saveUserData();
                }

                requestChangesBtn.style.display = 'block';
                promptInput.value = '';
                promptInput.placeholder = 'Request changes to the code...';
                showStatus(isChange ? 'Changes applied successfully!' : 'Code generated successfully!', 'success');

            } catch (error) {
                showStatus(`Error: ${error.message}`, 'error');
            } finally {
                generateBtn.disabled = false;
                requestChangesBtn.disabled = false;
            }
        }

        function showStatus(message, type) {
            status.className = `status ${type}`;
            status.textContent = message;
            status.style.display = 'block';
        }
    </script>
</body>
</html>
